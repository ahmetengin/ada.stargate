# ⚙️ Parasut.com API Integration for Ada.finance

**Reference:** [Parasut.com API Documentation](https://apidocs.parasut.com) - *Conceptual Integration*

---

## 1. Overview

This document outlines the conceptual integration of Parasut.com's API within Ada's `ada.finance.wim` node. Parasut.com, as a prominent e-invoicing and accounting platform, serves as a critical external system for managing marina financial operations, including invoicing, payment tracking, and customer financial profiles.

Ada's `financeAgent` utilizes a simulated "Model Context Protocol" (MCP) to interact with these functionalities, allowing for robust financial management without direct, real-time API calls in this prototype environment. This approach is designed to be easily extensible to a live API integration in a production environment.

---

## 2. Key API Endpoints and Data Models (Conceptual)

The `ada.finance` node primarily interacts with Parasut.com's API through the following conceptual endpoints and data structures:

### A. Invoice Management

This functionality is crucial for generating, updating, and tracking invoices for various marina services (mooring, lifting, utilities, penalties).

*   **Endpoint (Simulated):** `POST /v1/sales_invoices`
*   **Purpose:** To create new sales invoices for vessels.
*   **Request Data Model (`SalesInvoiceCreateRequest`):**
    ```json
    {
      "sales_invoice": {
        "item_type": "sales_invoice",
        "invoice_series": "A",
        "invoice_no": "0001",
        "issue_date": "2025-11-20",
        "due_date": "2025-12-05",
        "invoice_type": "sales",
        "currency": "TRL",
        "exchange_rate": "1.0",
        "client_id": "client_id_from_parasut",
        "invoice_items": [
          {
            "product_id": "product_id_from_parasut",
            "quantity": "1.0",
            "unit_price": "1500.00",
            "vat_rate": "18.0",
            "description": "Mooring Fee S/Y Phisedelia"
          }
        ],
        "notes": "Generated by Ada Marina for S/Y Phisedelia outstanding debt."
      }
    }
    ```
*   **Endpoint (Simulated):** `GET /v1/sales_invoices/{invoice_id}`
*   **Purpose:** To retrieve details of an existing invoice.
*   **Endpoint (Simulated):** `GET /v1/clients/{client_id}/sales_invoices`
*   **Purpose:** To list all invoices for a specific client (vessel).

### B. Payment Tracking and Account Balance

This allows Ada to check a vessel's outstanding balance and mark invoices as paid, directly impacting customer loyalty scores and departure protocols.

*   **Endpoint (Simulated):** `GET /v1/clients/{client_id}/balance`
*   **Purpose:** To fetch the current outstanding balance and payment history status for a given client (vessel).
*   **Response Data Model (`ClientBalanceResponse`):**
    ```json
    {
      "balance": {
        "outstanding_amount": 850.00,
        "currency": "EUR",
        "payment_history_status": "RECENTLY_LATE",
        "last_payment_date": "2025-10-15"
      }
    }
    ```
*   **Endpoint (Simulated):** `POST /v1/payments`
*   **Purpose:** To record a payment against an invoice or a client account.

### C. Client (Customer) Management

While less frequently accessed by `ada.finance`, the ability to retrieve or update basic client information (linked to `ada.customer`) is also available.

*   **Endpoint (Simulated):** `GET /v1/clients/{client_id}`
*   **Purpose:** To retrieve details of a client.

---

## 3. Ada Agent Integration within `ada.finance.wim`

The `financeAgent` encapsulates the logic for interacting with these conceptual APIs:

*   **`financeAgent.checkDebt(vesselName: string)`:**
    *   **Task:** Queries Parasut.com for the outstanding balance of a specific vessel.
    *   **Function:** Simulates a call to `/v1/clients/{client_id}/balance`, retrieves the `outstanding_amount` and `payment_history_status`.
    *   **Result:** Provides the debt status and payment history to the `orchestratorService` and `customerAgent`.

*   **`financeAgent.process(params: { intent: 'create_invoice', ... }, user: UserProfile)`:**
    *   **Task:** Initiates financial transactions like invoice creation.
    *   **Function:** Simulates a `POST /v1/sales_invoices` call, generating a new invoice object. If successful, it then simulates generating a payment link via Iyzico.
    *   **Result:** Returns `AgentAction` objects (`ada.finance.invoiceCreated`, `ada.finance.paymentLinkGenerated`) to the orchestrator.

*   **`financeAgent.clearDebt(vesselName: string)`:**
    *   **Task:** Simulates the process of marking a vessel's debt as settled.
    *   **Function:** Internally updates the mock balance for the vessel and simulates a `POST /v1/payments` call.
    *   **Result:** Confirms debt clearance, triggering updates to the vessel's loyalty score via `ada.customer`.

---

## 4. Strategic Impact

Integrating with a robust accounting system like Parasut.com (even conceptually) allows Ada to:
1.  **Automate Financial Workflows:** Streamline invoicing and payment tracking, reducing manual overhead.
2.  **Enforce Financial Policies:** Directly link debt status to operational decisions (e.g., departure clearance), ensuring compliance with WIM regulations.
3.  **Enhance Customer Loyalty:** Provide `ada.customer` with critical financial behavior data, enabling more nuanced loyalty scoring and proactive payment assistance.
4.  **Audit Trail:** Maintain a structured record of all financial transactions within the `ada.finance` node.

This deep integration elevates Ada's role in financial management, making it an indispensable part of the marina's business operations.
